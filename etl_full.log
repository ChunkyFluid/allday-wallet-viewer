==============================
 NFL ALL DAY ETL FULL REFRESH
==============================
Started at Fri Nov 28 09:07:17 EST 2025

Step 1/10: Sync NFT core metadata from Snowflake...
Postgres config: {
  host: 'ep-bitter-tooth-a4tly49h-pooler.us-east-1.aws.neon.tech',
  database: 'allday_analytics',
  ssl: true
}
Using Snowflake NFL_ALLDAY.ANALYTICS
{"level":"INFO","message":"[9:07:17.942 AM]: Creating new connection object"}
{"level":"INFO","message":"[9:07:17.959 AM]: Creating Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] with host: WBFEERF-YXC83821.snowflakecomputing.com, account: WBFEERF-YXC83821, accessUrl: https://WBFEERF-YXC83821.snowflakecomputing.com, user: CHUNK, password is provided, role: ACCOUNTADMIN, database: NFL_ALLDAY, schema: ANALYTICS, warehouse: COMPUTE_WH, region: undefined, authenticator: SNOWFLAKE, ocsp mode: FAIL_OPEN, os: darwin, os version: 23.5.0"}
{"level":"INFO","message":"[9:07:17.960 AM]: Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] additional details: passcode in password is provided, passcode is not provided, private key is not provided, application: undefined, client name: snowflake-sdk, client version: 1.15.0, retry timeout: 300, private key path: undefined, private key pass is not provided, client store temporary credential: false, browser response timeout: 120000"}
{"level":"INFO","message":"[9:07:17.961 AM]: Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] - connection object created successfully."}
{"level":"INFO","message":"[9:07:17.962 AM]: Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] - connecting. Associated Snowflake domain: GLOBAL"}
{"level":"INFO","message":"[9:07:17.963 AM]: Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] - authentication successful using: SNOWFLAKE"}
{"level":"INFO","message":"[9:07:17.964 AM]: Trying to initialize Easy Logging"}
{"level":"INFO","message":"[9:07:17.968 AM]: No client config detected."}
{"level":"INFO","message":"[9:07:17.968 AM]: No config file path found. Client config will not be used."}
{"level":"INFO","message":"[9:07:17.969 AM]: Easy Logging is disabled as no config has been found"}
{"level":"INFO","message":"[9:07:17.974 AM]: Connection[id: b0520e21-8a07-44c0-9c9d-4291416c295e] - connected successfully after 12.405638999999951 milliseconds"}
✅ Connected to Snowflake as b0520e21-8a07-44c0-9c9d-4291416c295e
Ensuring Neon nft_core_metadata table exists...
Current Neon nft_core_metadata row count (before sync): 100000
Truncating Neon nft_core_metadata (full snapshot sync)...
Fetching metadata batch from Snowflake: after_nft_id=START, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 100000 nft_core_metadata rows so far... last_nft_id=10244112
Fetching metadata batch from Snowflake: after_nft_id=10244112, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 200000 nft_core_metadata rows so far... last_nft_id=10401453
Fetching metadata batch from Snowflake: after_nft_id=10401453, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 300000 nft_core_metadata rows so far... last_nft_id=1900015
Fetching metadata batch from Snowflake: after_nft_id=1900015, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 400000 nft_core_metadata rows so far... last_nft_id=3896148
Fetching metadata batch from Snowflake: after_nft_id=3896148, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 500000 nft_core_metadata rows so far... last_nft_id=5443650
Fetching metadata batch from Snowflake: after_nft_id=5443650, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 600000 nft_core_metadata rows so far... last_nft_id=6142382
Fetching metadata batch from Snowflake: after_nft_id=6142382, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 700000 nft_core_metadata rows so far... last_nft_id=6341065
Fetching metadata batch from Snowflake: after_nft_id=6341065, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 800000 nft_core_metadata rows so far... last_nft_id=6528923
Fetching metadata batch from Snowflake: after_nft_id=6528923, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 900000 nft_core_metadata rows so far... last_nft_id=6691823
Fetching metadata batch from Snowflake: after_nft_id=6691823, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1000000 nft_core_metadata rows so far... last_nft_id=6882480
Fetching metadata batch from Snowflake: after_nft_id=6882480, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1100000 nft_core_metadata rows so far... last_nft_id=7312784
Fetching metadata batch from Snowflake: after_nft_id=7312784, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1200000 nft_core_metadata rows so far... last_nft_id=8019948
Fetching metadata batch from Snowflake: after_nft_id=8019948, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1300000 nft_core_metadata rows so far... last_nft_id=8481153
Fetching metadata batch from Snowflake: after_nft_id=8481153, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1400000 nft_core_metadata rows so far... last_nft_id=8888326
Fetching metadata batch from Snowflake: after_nft_id=8888326, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1500000 nft_core_metadata rows so far... last_nft_id=9433756
Fetching metadata batch from Snowflake: after_nft_id=9433756, limit=100000...
Snowflake returned 100000 metadata rows for this batch.
Inserting 100000 metadata rows into Neon...
Upserted 1600000 nft_core_metadata rows so far... last_nft_id=9972870
Fetching metadata batch from Snowflake: after_nft_id=9972870, limit=100000...
Snowflake returned 8742 metadata rows for this batch.
Inserting 8742 metadata rows into Neon...
Upserted 1608742 nft_core_metadata rows so far... last_nft_id=9999998
Fetching metadata batch from Snowflake: after_nft_id=9999998, limit=100000...
Snowflake returned 0 metadata rows for this batch.
No more metadata rows from Snowflake. Done reading.
✅ Final Neon nft_core_metadata row count: 1608742
✅ Metadata sync complete.
Step 2/10: Sync wallet holdings from Snowflake...
Postgres config: {
  host: 'ep-bitter-tooth-a4tly49h-pooler.us-east-1.aws.neon.tech',
  database: 'allday_analytics',
  ssl: true
}
Using Snowflake NFL_ALLDAY.ANALYTICS
{"level":"INFO","message":"[9:09:02.885 AM]: Creating new connection object"}
{"level":"INFO","message":"[9:09:02.895 AM]: Creating Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] with host: WBFEERF-YXC83821.snowflakecomputing.com, account: WBFEERF-YXC83821, accessUrl: https://WBFEERF-YXC83821.snowflakecomputing.com, user: CHUNK, password is provided, role: ACCOUNTADMIN, database: NFL_ALLDAY, schema: ANALYTICS, warehouse: COMPUTE_WH, region: undefined, authenticator: SNOWFLAKE, ocsp mode: FAIL_OPEN, os: darwin, os version: 23.5.0"}
{"level":"INFO","message":"[9:09:02.895 AM]: Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] additional details: passcode in password is provided, passcode is not provided, private key is not provided, application: undefined, client name: snowflake-sdk, client version: 1.15.0, retry timeout: 300, private key path: undefined, private key pass is not provided, client store temporary credential: false, browser response timeout: 120000"}
{"level":"INFO","message":"[9:09:02.895 AM]: Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] - connection object created successfully."}
{"level":"INFO","message":"[9:09:02.896 AM]: Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] - connecting. Associated Snowflake domain: GLOBAL"}
{"level":"INFO","message":"[9:09:02.896 AM]: Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] - authentication successful using: SNOWFLAKE"}
{"level":"INFO","message":"[9:09:02.897 AM]: Trying to initialize Easy Logging"}
{"level":"INFO","message":"[9:09:02.899 AM]: No client config detected."}
{"level":"INFO","message":"[9:09:02.899 AM]: No config file path found. Client config will not be used."}
{"level":"INFO","message":"[9:09:02.899 AM]: Easy Logging is disabled as no config has been found"}
{"level":"INFO","message":"[9:09:02.902 AM]: Connection[id: 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b] - connected successfully after 6.188612999999975 milliseconds"}
✅ Connected to Snowflake as 6c5f0bd1-8b16-4f4d-ac1a-b8d2d5ab912b
Ensuring Neon wallet_holdings table exists...
Current Neon wallet_holdings row count (before sync): 50000
Current max last_event_ts in Neon wallet_holdings: 2025-11-28T11:47:30.510Z
Fetching holdings batch from Snowflake: last_event_ts > Fri Nov 28 2025 06:47:30 GMT-0500 (Eastern Standard Time), after=(START, START), limit=100000...
Snowflake returned 0 rows for this batch.
No more rows from Snowflake. Done reading.
✅ Final Neon wallet_holdings row count: 50000
✅ Wallet holdings sync complete.
Step 3/10: Sync wallet profiles from Dapper...
Postgres config: {
  host: 'ep-bitter-tooth-a4tly49h-pooler.us-east-1.aws.neon.tech',
  database: 'allday_analytics',
  ssl: true
}
=== Sync wallet profiles from Dapper -> Neon ===
Ensuring Neon wallet_profiles table exists...
Current Neon wallet_profiles row count (before sync): 124086
Selecting wallets that don't have a profile yet...
Found 856 wallets to fetch profiles for.
Processed 100/856 wallets...
Fetch error for 0x1a514f8aec30b47d: request to https://open.meetdapper.com/profile?address=0x1a514f8aec30b47d failed, reason: read ECONNRESET
Processed 200/856 wallets...
Processed 300/856 wallets...
Processed 400/856 wallets...
Processed 500/856 wallets...
Processed 600/856 wallets...
Processed 700/856 wallets...
Processed 800/856 wallets...
✅ Done. Total wallets processed this run: 856
Final wallet_profiles row count: 124942
✅ wallet_profiles sync complete.
Step 4/10: Load edition prices...
Loading prices from edition_prices.csv...
Upserted 1000 rows so far...
Upserted 2000 rows so far...
Upserted 3000 rows so far...
Upserted 4000 rows so far...
Done. Total rows upserted: 4987
Step 5/10: Refresh editions_snapshot...
Refreshing editions_snapshot…
✅ editions_snapshot refresh complete.
Step 6/10: Refresh top_wallets_snapshot...
Refreshing top_wallets_snapshot…
top_wallets_snapshot refresh complete.
Step 7/10: Refresh top_wallets_by_team_snapshot...
Refreshing top_wallets_by_team_snapshot…
top_wallets_by_team_snapshot refresh complete.
Step 8/10: Refresh top_wallets_by_tier_snapshot...
Refreshing top_wallets_by_tier_snapshot…
top_wallets_by_tier_snapshot refresh complete.
Step 9/10: Refresh top_wallets_by_value_snapshot...
Refreshing top_wallets_by_value_snapshot…
top_wallets_by_value_snapshot refresh complete.
Step 10/10: Refresh explorer_filters_snapshot...
Refreshing explorer_filters_snapshot…
Explorer filters counts: { players: 0, teams: 0, series: 9, sets: 125, positions: 0, tiers: 5 }
explorer_filters_snapshot refresh complete.

==============================
 ETL COMPLETE!
==============================
Finished at Fri Nov 28 10:08:35 EST 2025
