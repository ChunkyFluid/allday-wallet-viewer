<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NFL All Day Authentication | Connect Your Account</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="header.css" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #050815;
      --card: #0b1020;
      --border: #1b2236;
      --text: #f8f9ff;
      --text-muted: #8c95b8;
      --accent: #22c55e;
      --purple: #6f42c1;
      --blue: #3b82f6;
      --gold: #fbbf24;
    }

    body {
      background: radial-gradient(circle at top, #101526 0, #050815 55%);
      min-height: 100vh;
      font-family: 'Outfit', sans-serif;
      color: var(--text);
      margin: 0;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1rem;
    }

    .intro {
      color: var(--text-muted);
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .step-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .step-number {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
    }

    .step-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .step-content {
      color: var(--text-muted);
      line-height: 1.6;
    }

    .step-content a {
      color: var(--blue);
    }

    .code-block {
      background: #1a1f2e;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      overflow-x: auto;
      color: var(--gold);
    }

    .token-input {
      width: 100%;
      padding: 1rem;
      background: #1a1f2e;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      margin: 1rem 0;
      resize: vertical;
      min-height: 100px;
    }

    .token-input:focus {
      outline: none;
      border-color: var(--blue);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      transition: transform 0.2s;
    }

    .btn:hover { transform: translateY(-2px); }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--blue));
      color: white;
    }

    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }

    .status {
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: var(--accent);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }

    .status.hidden { display: none; }

    .current-token {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .current-token h3 {
      color: var(--accent);
      margin: 0 0 0.5rem 0;
    }

    .bookmarklet-link {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, var(--gold), #f59e0b);
      color: #000;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: grab;
    }

    .bookmarklet-link:hover {
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div id="app-header"></div>
  <script src="/layout.js"></script>
  <main class="app-main">
    <div class="container">
      <h1>üîê Connect NFL All Day Account</h1>
      
      <p class="intro">
        To access Playbook, Challenges, and Offers data, we need your NFL All Day authentication token.
        This token is created when you log into nflallday.com and allows us to fetch your personalized data.
      </p>

      <div id="current-status"></div>

      <div class="step-card">
        <div class="step-header">
          <div class="step-number">1</div>
          <div class="step-title">Log into NFL All Day</div>
        </div>
        <div class="step-content">
          <p>Open <a href="https://nflallday.com" target="_blank">nflallday.com</a> in a new tab and make sure you're logged in with your Dapper account.</p>
        </div>
      </div>

      <div class="step-card">
        <div class="step-header">
          <div class="step-number">2</div>
          <div class="step-title">Open Developer Tools</div>
        </div>
        <div class="step-content">
          <p>While on nflallday.com, press <strong>F12</strong> (or right-click ‚Üí Inspect) to open Developer Tools.</p>
          <p>Go to the <strong>Application</strong> tab (Chrome) or <strong>Storage</strong> tab (Firefox).</p>
        </div>
      </div>

      <div class="step-card">
        <div class="step-header">
          <div class="step-number">3</div>
          <div class="step-title">Find Your Token</div>
        </div>
        <div class="step-content">
          <p>In the left sidebar, expand <strong>Local Storage</strong> ‚Üí click on <strong>https://nflallday.com</strong></p>
          <p>Look for a key containing <code>idToken</code> or <code>accessToken</code>. The value is a long string starting with <code>eyJ...</code></p>
          <p>Alternatively, look in <strong>Cookies</strong> for <code>nfl_session</code> or similar.</p>
        </div>
      </div>

      <div class="step-card">
        <div class="step-header">
          <div class="step-number">4</div>
          <div class="step-title">Paste Your Token</div>
        </div>
        <div class="step-content">
          <p>Copy the token value and paste it below:</p>
          <textarea id="token-input" class="token-input" placeholder="Paste your token here (starts with eyJ... or is a long session string)"></textarea>
          <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="saveToken()">üíæ Save Token</button>
            <button class="btn btn-secondary" onclick="testToken()">üß™ Test Connection</button>
            <button class="btn btn-secondary" onclick="clearToken()">üóëÔ∏è Clear Token</button>
          </div>
          <div id="status" class="status hidden"></div>
        </div>
      </div>

      <div class="step-card">
        <div class="step-header">
          <div class="step-number">‚ö°</div>
          <div class="step-title">Quick Method: Run in Console</div>
        </div>
        <div class="step-content">
          <p>While logged into nflallday.com, open DevTools (F12) ‚Üí Console tab, and paste this:</p>
          <div class="code-block" style="font-size: 0.75rem; white-space: pre-wrap;">// Find all tokens and cookies
console.log('=== SEARCHING FOR TOKENS ===');

// Check localStorage
console.log('\\n--- localStorage ---');
for(let i=0; i&lt;localStorage.length; i++){
  let k=localStorage.key(i);
  let v=localStorage.getItem(k);
  if(v &amp;&amp; (k.toLowerCase().includes('token') || k.toLowerCase().includes('auth') || k.toLowerCase().includes('session') || v.startsWith('eyJ'))){
    console.log(k+':', v.substring(0,100)+'...');
  }
}

// Check for JWT tokens anywhere
console.log('\\n--- JWT Tokens (eyJ...) ---');
for(let i=0; i&lt;localStorage.length; i++){
  let v=localStorage.getItem(localStorage.key(i));
  if(v &amp;&amp; v.includes('eyJ')){
    let match = v.match(/eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+/);
    if(match) console.log('Found JWT:', match[0].substring(0,80)+'...');
  }
}

// Check cookies
console.log('\\n--- Cookies ---');
document.cookie.split(';').forEach(c=>{
  if(c.includes('session') || c.includes('token') || c.includes('auth')){
    console.log(c.trim());
  }
});

console.log('\\n=== Copy any JWT token (eyJ...) you see above ===');</div>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem;">
            This will show all potential tokens. Copy any <code>eyJ...</code> value you see.
          </p>
        </div>
      </div>
      
      <div class="step-card">
        <div class="step-header">
          <div class="step-number">üîç</div>
          <div class="step-title">Alternative: Network Tab</div>
        </div>
        <div class="step-content">
          <p>Another way to find your token:</p>
          <ol style="color: var(--text-muted); line-height: 1.8;">
            <li>On nflallday.com, open DevTools (F12) ‚Üí <strong>Network</strong> tab</li>
            <li>Filter by "graphql" in the search box</li>
            <li>Click on any request to nflallday.com/consumer/graphql</li>
            <li>Look in <strong>Request Headers</strong> for:
              <ul>
                <li><code>Authorization: Bearer eyJ...</code></li>
                <li><code>X-Id-Token: eyJ...</code></li>
              </ul>
            </li>
            <li>Copy the <code>eyJ...</code> token value</li>
          </ol>
        </div>
      </div>
    </div>
  </main>

  <script>
    function updateCurrentStatus() {
      const container = document.getElementById('current-status');
      
      fetch('/api/me', { credentials: 'include' })
        .then(res => res.json())
        .then(data => {
          if (data.ok && data.hasNfladToken) {
            container.innerHTML = `
              <div class="current-token">
                <h3>‚úÖ Token Connected</h3>
                <p>Your NFL All Day token is saved. Playbook, Challenges, and Offers should work.</p>
                <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem;">
                  Token expires: ${data.tokenExpiry || 'Unknown'}
                </p>
              </div>
            `;
          } else {
            container.innerHTML = '';
          }
        })
        .catch(() => {
          container.innerHTML = '';
        });
    }

    function saveToken() {
      const token = document.getElementById('token-input').value.trim();
      const status = document.getElementById('status');
      
      if (!token) {
        status.className = 'status error';
        status.textContent = '‚ùå Please paste a token first';
        return;
      }
      
      fetch('/api/nflad-token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ token })
      })
        .then(res => res.json())
        .then(data => {
          if (data.ok) {
            status.className = 'status success';
            status.textContent = '‚úÖ Token saved! Try the Playbook or Challenges page now.';
            updateCurrentStatus();
          } else {
            status.className = 'status error';
            status.textContent = '‚ùå ' + (data.error || 'Failed to save token');
          }
        })
        .catch(err => {
          status.className = 'status error';
          status.textContent = '‚ùå Error: ' + err.message;
        });
    }

    function testToken() {
      const token = document.getElementById('token-input').value.trim();
      const status = document.getElementById('status');
      
      status.className = 'status';
      status.style.background = 'rgba(59, 130, 246, 0.1)';
      status.style.borderColor = 'rgba(59, 130, 246, 0.3)';
      status.style.color = '#3b82f6';
      status.textContent = 'üîÑ Testing connection...';
      
      // Save token first, then test
      fetch('/api/nflad-token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ token: token || 'test' })
      })
        .then(() => fetch('/api/kickoffs', { credentials: 'include' }))
        .then(res => res.json())
        .then(data => {
          if (data.ok && data.kickoffs && data.kickoffs.length > 0) {
            status.className = 'status success';
            status.textContent = `‚úÖ Success! Found ${data.kickoffs.length} active kickoffs.`;
          } else if (data.error && data.error.includes('403')) {
            status.className = 'status error';
            status.textContent = '‚ùå Token not working - still getting 403. Try a different token or cookie.';
          } else {
            status.className = 'status error';
            status.textContent = '‚ùå ' + (data.error || 'No data returned');
          }
        })
        .catch(err => {
          status.className = 'status error';
          status.textContent = '‚ùå Error: ' + err.message;
        });
    }

    function clearToken() {
      fetch('/api/nflad-token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ token: '' })
      })
        .then(() => {
          const status = document.getElementById('status');
          status.className = 'status';
          status.style.background = 'rgba(107, 114, 128, 0.1)';
          status.style.borderColor = 'rgba(107, 114, 128, 0.3)';
          status.style.color = 'var(--text-muted)';
          status.textContent = 'Token cleared.';
          document.getElementById('token-input').value = '';
          updateCurrentStatus();
        });
    }

    // Check current status on load
    updateCurrentStatus();
  </script>
</body>
</html>

